name: main.yml
on:
    pull_request:
    workflow_dispatch:

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

jobs:
    php-fixer:
        uses: ./.github/workflows/fix-php.yml

    static-analysis:
        needs: [php-fixer]
        uses: ./.github/workflows/static-analysis.yml

    js-fixer:
        # needs to wait on php-fixer for the .ts definitions generated by wayfinder
        needs: [php-fixer]
        uses: ./.github/workflows/lint-and-build-frontend.yml

    pest-tests:
        needs: [js-fixer, php-fixer]
        uses: ./.github/workflows/run-pest-tests.yml
